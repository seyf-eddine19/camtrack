{% extends "contracts/base.html" %}
{% block title %}Coordination Requests{% endblock %}

{% block content %}
<div class="container-fluid px-3 px-md-4 py-4">

  <!-- Filter Form -->
  <div class="bg-white shadow p-3 p-md-4 border border-light-subtle">
    <form method="get" class="row gx-3 gy-2 align-items-end">

      <!-- Contract Filter -->
      <div class="col-md-6">
        <label class="form-label fw-semibold text-muted">
          <i class="bi bi-file-earmark-text me-1"></i>Contract:
        </label>
        <select name="contract" class="form-select form-select-sm" onchange="this.form.submit()">
          {% for contract in contracts %}
            <option value="{{ contract.pk }}" {% if filter_contract == contract.pk|stringformat:"s" %}selected{% endif %}>
              {{ contract.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Zone Filter -->
      <div class="col-md-6">
        <label class="form-label fw-semibold text-muted">
          <i class="bi bi-geo-alt-fill me-1"></i>Zone:
        </label>
        <select name="zone" class="form-select form-select-sm" onchange="this.form.submit()">
          <option value="">All Zones</option>
          {% for zone in zones %}
            <option value="{{ zone.id }}" {% if filter_zone == zone.id|stringformat:"s" %}selected{% endif %}>
              {{ zone.name }}
            </option>
          {% endfor %}
        </select>
      </div>
    </form>
  </div>

  <!-- Coordination Table -->
  <div class="bg-white shadow p-3 p-md-4 mt-4 border border-light-subtle">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
      <h4 class="fw-bold text-primary mb-3 mb-md-0">
        <i class="bi bi-link-45deg me-1"></i> Coordination Requests
      </h4>
      <a href="{% url 'coordination_add' %}" class="btn btn-success">
        <i class="bi bi-plus-circle me-1"></i> New Request
      </a>
    </div>

    <div class="table-responsive">
      <table class="table align-middle text-center">
        <thead class="table-light small text-uppercase">
          <tr>
            <th>#</th>
            <th>Zone</th>
            <th>Department</th>
            <th>Work Type</th>
            <th>Request Date</th>
            <th>Execution Date</th>
            <th>Responsible</th>
            <th>Phone</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for request in requests %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ request.zone.name }}</td>
            <td>{{ request.target_department }}</td>
            <td>{{ request.work_type }}</td>
            <td>{{ request.request_date|date:"Y-m-d" }}</td>
            <td>{{ request.expected_execution_date|date:"Y-m-d" }}</td>
            <td>{{ request.responsible_person }}</td>
            <td>{{ request.phone_number }}</td>
            <td>
              <div class="d-flex gap-2 flex-wrap justify-content-center">
                <a href="{% url 'coordination_edit' request.pk %}" class="btn btn-sm btn-icon btn-edit" title="Edit">
                  <i class="bi bi-pencil"></i>
                </a>
                <a href="{% url 'coordination_delete' request.pk %}" class="btn btn-sm btn-icon btn-delete" title="Delete">
                  <i class="bi bi-trash"></i>
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="9" class="text-muted text-center">No coordination requests found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
