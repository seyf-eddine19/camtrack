{% extends "contracts/base.html" %}
{% block title %}Site Dashboard{% endblock %}

{% block content %}
<div class="container-fluid p-4">
  <h3 class="fw-bold text-primary mb-4"><i class="bi bi-speedometer2 me-1"></i> Site Dashboard</h3>
  <div class="row g-4 mb-4">

    <!-- Devices Summary Card -->
    <div class="col-sm-6 col-ml-3">
      <div class="card shadow border rounded-2 overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center mb-4">
            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
              <i class="bi bi-cpu fs-4"></i>
            </div>
            <div>
              <h6 class="text-primary fw-bold mb-1">Devices</h6>
              <small class="text-muted">By status</small>
            </div>
            <div class="ms-auto">
              <span class="badge bg-primary text-white px-3 py-2 rounded-pill fw-semibold">{{ total_devices }}</span>
            </div>
          </div>
  
          <div class="d-flex flex-wrap gap-3 small">
            <!-- Installed -->
            <div class="flex-fill">
              <div class="text-success">
                <i class="bi bi-hdd-rack-fill fs-5"></i>
                <span class="fs-5 fw-bold">{{ installed_devices }}</span>
              </div>
              <div class="text-muted small">Installed</div>
            </div>
  
            <!-- Available -->
            <div class="flex-fill">
              <div class="text-info">
                <i class="bi bi-box-seam fs-5"></i>
                <span class="fs-5 fw-bold">{{ available_devices }}</span>
              </div>
              <div class="text-muted small">Available</div>
            </div>
  
            <!-- Damaged -->
            <div class="flex-fill">
              <div class="text-danger">
                <i class="bi bi-x-octagon-fill fs-5"></i>
                <span class="fs-5 fw-bold">{{ damaged_devices }}</span>
              </div>
              <div class="text-muted small">Damaged</div>
            </div>
          </div>
        </div>
        <div class="border-bottom border-4 border-primary"></div>
      </div>
    </div>

    <!-- Tasks Summary Card -->
    <div class="col-sm-6 col-ml-3">
      <div class="card shadow border rounded-2 overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center mb-4">
            <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
              <i class="bi bi-list-check fs-4"></i>
            </div>
            <div>
              <h6 class="text-success fw-bold mb-1 mb-0">Tasks</h6>
              <small class="text-muted">Summary by status</small>
            </div>
            <div class="ms-auto">
              <span class="badge bg-success text-white px-3 py-2 rounded-pill fw-semibold">{{ task_summary.total }}</span>
            </div>
          </div>
  
          <!-- Stats Inline -->
          <div class="d-flex flex-wrap gap-3 small">
            <!-- Completed -->
            <div class="flex-fill">
              <div class="text-success">
                <i class="bi bi-check-circle-fill fs-5"></i>
                <span class="fs-5 fw-bold">{{ task_summary.completed }}</span>
              </div>
              <div class="text-muted small">Completed</div>
            </div>
    
            <!-- Not Started -->
            <div class="flex-fill">
              <div class="text-secondary">
                <i class="bi bi-hourglass fs-5"></i>
                <span class="fs-5 fw-bold">{{ task_summary.not_started }}</span>
              </div>
              <div class="text-muted small">Not Started</div>
            </div>
    
            <!-- Ongoing -->
            <div class="flex-fill">
              <div class="text-warning">
                <i class="bi bi-arrow-repeat fs-5"></i>
                <span class="fs-5 fw-bold">{{ task_summary.ongoing }}</span>
              </div>
              <div class="text-muted small">Ongoing</div>
            </div>
    
            <!-- Delayed -->
            <div class="flex-fill">
              <div class="text-danger">
                <i class="bi bi-exclamation-triangle-fill fs-5"></i>
                <span class="fs-5 fw-bold">{{ task_summary.delayed }}</span>
              </div>
              <div class="text-muted small">Delayed</div>
            </div>
    
          </div>
        </div>
        <div class="border-bottom border-4 border-success"></div>
      </div>
    </div>
  
    <!-- Maintenance Summary Card -->
    <div class="col-sm-6 col-ml-3">
      <div class="card shadow border rounded-2 overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center mb-4">
            <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
              <i class="bi bi-tools fs-4"></i>
            </div>
            <div>
              <h6 class="text-danger fw-bold mb-1">Maintenance</h6>
              <small class="text-muted">Repair reports</small>
            </div>
            <div class="ms-auto">
              <span class="badge bg-danger text-white px-3 py-2 rounded-pill fw-semibold">{{ maintenance_summary.total }}</span>
            </div>
          </div>
  
          <div class="d-flex flex-wrap gap-3 small">
            <!-- Repaired -->
            <div class="flex-fill">
              <div class="text-success">
                <i class="bi bi-wrench fs-5"></i>
                <span class="fs-5 fw-bold">{{ maintenance_summary.repaired }}</span>
              </div>
              <div class="text-muted small">Repaired</div>
            </div>
    
            <!-- Pending -->
            <div class="flex-fill">
              <div class="text-warning">
                <i class="bi bi-clock-history fs-5"></i>
                <span class="fs-5 fw-bold">{{ maintenance_summary.pending }}</span>
              </div>
              <div class="text-muted small">Pending</div>
            </div>
    
          </div>
        </div>
        <div class="border-bottom border-4 border-danger"></div>
      </div>
    </div>
  
    <!-- Coordination Summary Card -->
    <div class="col-sm-6 col-ml-3">
      <div class="card shadow border rounded-2 overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center mb-4">
            <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
              <i class="bi bi-envelope-paper fs-4"></i>
            </div>
            <div>
              <h6 class="text-info fw-bold mb-1">Coordination</h6>
              <small class="text-muted">Zone requests</small>
            </div>
            <div class="ms-auto">
              <span class="badge bg-info text-white px-3 py-2 rounded-pill fw-semibold">{{ coordination_summary.total }}</span>
            </div>
          </div>
  
          <div class="d-flex flex-wrap gap-3 small">
            <!-- Total Requests -->
            <div class="flex-fill">
              <div class="text-info">
                <i class="bi bi-envelope-open fs-5"></i>
                <span class="fs-5 fw-bold">{{ coordination_summary.total }}</span>
              </div>
              <div class="text-muted small">Total Requests</div>
            </div>
            <!-- Last Date -->
            <div class="flex-fill">
              <div class="text-secondary">
                <i class="bi bi-calendar-event fs-5"></i>
                <span class="fs-5 fw-bold">{{ coordination_summary.last_date }}</span>
              </div>
              <div class="text-muted small">Last Request</div>
            </div>
    
          </div>
        </div>
        <div class="border-bottom border-4 border-info"></div>
      </div>
    </div>
  </div>
  
  <!-- Latest Items -->
  <div class="row g-4">
    <!-- Contracts & Zones Summary Card -->
    <div class="col-md-9">
      <div class="card shadow border rounded-2 overflow-hidden">
        <div class="card-header bg-primary p-4">
    
          <!-- Header Section: Total Contracts & Zones -->
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <div class="bg-white text-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                <i class="bi bi-file-earmark-text fs-4"></i>
              </div>
              <div>
                <h6 class="text-white fw-bold mb-1">Contracts</h6>
                <small class="text-white">Overview</small>
              </div>
            </div>
            <div class="text-end">
              <div>
                <span class="badge bg-white text-primary fw-semibold px-3 py-2 rounded-pill">
                  {{ total_contracts }} Contracts
                </span>
              </div>
              <div class="mt-2">
                <span class="badge bg-white text-secondary fw-semibold px-3 py-2 rounded-pill">
                  {{ total_zones }} Zones
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body p-4">
    
          <!-- Recent Contracts List -->
          <h6 class="text-muted fw-semibold mb-2">Recent Contracts</h6>
          <div class="border-top pt-3 mt-3">
            <ul class="list-group list-group-flush">
              {% for contract in latest_contracts %}
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                <a href="{% url 'contract_detail' contract.pk %}" title="View">
                  <div>
                  <div class="fw-bold text-primary mb-1">
                    <i class="bi bi-file-earmark-check me-1"></i> {{ contract.name }}
                  </div>
                  <div class="text-muted small">
                    <i class="bi bi-calendar2-week me-1"></i> {{ contract.start_date }}<br>
                    <i class="bi bi-hash me-1"></i> {{ contract.contract_number }}
                  </div>
                </div>
                <span class="badge bg-secondary text-white fw-semibold px-3 py-2 rounded-pill">
                  {{ contract.zones.count }} Zones
                </span></a>
              </li>
              {% empty %}
              <li class="list-group-item text-muted px-0">No recent contracts available.</li>
              {% endfor %}
            </ul>
          </div>
    
        </div>
        <div class="border-bottom border-4 border-primary"></div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-header bg-warning text-dark">
          <i class="bi bi-list-task me-1"></i> Latest Tasks
        </div>
        <ul class="list-group list-group-flush">
          {% for task in latest_tasks %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ task.name }} 
                <small class="badge bg-secondary">
                  {{ task.get_status_display }}
                </small>
              </span>
              <small>{{ task.deadline }}
              <p class="m-0">
                {% if task.remaining_days > 0 %}
                  <span class="text-success"><i class="bi bi-clock me-1"></i>{{ task.remaining_days }} days</span>
                {% elif task.remaining_days == 0 %}
                  <span class="text-warning"><i class="bi bi-clock me-1"></i>Today</span>
                {% else %}
                  <span class="text-danger"><i class="bi bi-clock me-1"></i>{{ task.remaining_days }} days late</span>
                {% endif %}
              </p></small>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">All tasks are completed.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    
  </div>
</div>
{% endblock %}
